prompt --application/pages/page_00020beginwwv_flow_api.create_page( p_id=>20,p_user_interface_id=>wwv_flow_api.id(327304041051455600),p_name=>'User order details',p_page_mode=>'NORMAL',p_step_title=>'User order details',p_step_sub_title=>'User order details',p_step_sub_title_type=>'TEXT_WITH_SUBSTITUTIONS',p_first_item=>'NO_FIRST_ITEM',p_autocomplete_on_off=>'OFF',p_inline_css=>wwv_flow_string.join(wwv_flow_t_varchar2('','body{','    font-family: ''Comic Sans MS'';','}')),p_page_template_options=>'#DEFAULT#',p_required_role=>wwv_flow_api.id(328321042163774142),p_overwrite_navigation_list=>'N',p_page_is_public_y_n=>'N',p_cache_mode=>'NOCACHE',p_last_updated_by=>'defaultUser',p_last_upd_yyyymmddhh24miss=>'20000101000000');wwv_flow_api.create_page_plug( p_id=>wwv_flow_api.id(350060261006161975),p_plug_name=>'Breadcrumb',p_region_template_options=>'#DEFAULT#:t-BreadcrumbRegion--useBreadcrumbTitle',p_component_template_options=>'#DEFAULT#',p_plug_template=>wwv_flow_api.id(327274899983455556),p_plug_display_sequence=>10,p_include_in_reg_disp_sel_yn=>'N',p_plug_display_point=>'REGION_POSITION_01',p_menu_id=>wwv_flow_api.id(327305317139455601),p_plug_source_type=>'NATIVE_BREADCRUMB',p_menu_template_id=>wwv_flow_api.id(327293780686455585),p_plug_query_row_template=>1);wwv_flow_api.create_page_plug( p_id=>wwv_flow_api.id(350060829115161976),p_plug_name=>'User order details',p_region_template_options=>'#DEFAULT#',p_plug_template=>wwv_flow_api.id(327269938950455546),p_plug_display_sequence=>21,p_include_in_reg_disp_sel_yn=>'N',p_plug_display_point=>'BODY',p_plug_source=>wwv_flow_string.join(wwv_flow_t_varchar2('select PRODUCT_ID,','       PRODUCT_NAME,','       PRODUCT_DESC,','       decode(nvl(dbms_lob.getlength(PRODUCT_IMAGE),0),0,null,','       ''<img src="'' || APEX_UTIL.GET_BLOB_FILE_SRC (''P5_PRODUCT_IMAGE'',product_id) || ''" height="75" width="75" />'') as Image,','       PRODUCT_DETAIL_ID,','       SEX_NAME,','       SIZE_LOWER_VALUE||''-''||SIZE_HIGHER_VALUE as "Size Range",','       ORDER_PRODUCT_QUANTITY,','       PRODUCT_UNITARY_PRICE,','       PRODUCT_TOTAL_PRICE','  from SOK_ORDER_CONTENT_DETAIL_VW','  where order_id = :P20_order_id')),p_plug_source_type=>'NATIVE_IR',p_plug_query_row_template=>1,p_plug_query_options=>'DERIVED_REPORT_COLUMNS');wwv_flow_api.create_worksheet( p_id=>wwv_flow_api.id(350060926433161976),p_name=>'User order details',p_max_row_count=>'1000000',p_max_row_count_message=>'The maximum row count for this report is #MAX_ROW_COUNT# rows.  Please apply a filter to reduce the number of records in your query.',p_no_data_found_message=>'No data found.',p_show_nulls_as=>'-',p_pagination_type=>'ROWS_X_TO_Y',p_pagination_display_pos=>'BOTTOM_RIGHT',p_report_list_mode=>'TABS',p_show_detail_link=>'C',p_download_formats=>'CSV:HTML:EMAIL:XLS:PDF:RTF',p_detail_link=>'f?p=&APP_ID.:19:&SESSION.::&DEBUG.:RP,19:P19_ORDER_ID,P19_PRODUCT_DETAIL_ID:&P20_ORDER_ID.,#PRODUCT_DETAIL_ID#',p_detail_link_text=>'<img src="#IMAGE_PREFIX#app_ui/img/icons/apex-edit-pencil.png" class="apex-edit-pencil" alt="">',p_detail_link_condition_type=>'EXISTS',p_detail_link_cond=>wwv_flow_string.join(wwv_flow_t_varchar2('select * from SOK_ORDER','where order_id = :P20_ORDER_ID and order_status_code = ''PAID''')),p_owner=>'KPQ',p_internal_uid=>350061536433161976);wwv_flow_api.create_worksheet_column( p_id=>wwv_flow_api.id(350061301923161979),p_db_column_name=>'PRODUCT_ID',p_display_order=>1,p_column_identifier=>'A',p_column_label=>'Product Id',p_column_type=>'NUMBER',p_heading_alignment=>'RIGHT',p_column_alignment=>'RIGHT',p_tz_dependent=>'N');wwv_flow_api.create_worksheet_column( p_id=>wwv_flow_api.id(350061692045161982),p_db_column_name=>'PRODUCT_NAME',p_display_order=>2,p_column_identifier=>'B',p_column_label=>'Name',p_column_type=>'STRING',p_column_alignment=>'CENTER');wwv_flow_api.create_worksheet_column( p_id=>wwv_flow_api.id(350062125025161982),p_db_column_name=>'PRODUCT_DESC',p_display_order=>3,p_column_identifier=>'C',p_column_label=>'Description',p_column_type=>'STRING',p_column_alignment=>'CENTER');wwv_flow_api.create_worksheet_column( p_id=>wwv_flow_api.id(350062951151161984),p_db_column_name=>'PRODUCT_DETAIL_ID',p_display_order=>5,p_column_identifier=>'E',p_column_label=>'Product Detail Id',p_column_type=>'NUMBER',p_heading_alignment=>'RIGHT',p_column_alignment=>'RIGHT',p_tz_dependent=>'N');wwv_flow_api.create_worksheet_column( p_id=>wwv_flow_api.id(350063379063161984),p_db_column_name=>'SEX_NAME',p_display_order=>6,p_column_identifier=>'F',p_column_label=>'Sex ',p_column_type=>'STRING',p_column_alignment=>'CENTER');wwv_flow_api.create_worksheet_column( p_id=>wwv_flow_api.id(350064494371161985),p_db_column_name=>'ORDER_PRODUCT_QUANTITY',p_display_order=>9,p_column_identifier=>'I',p_column_label=>'Quantity',p_column_type=>'NUMBER',p_column_alignment=>'CENTER');wwv_flow_api.create_worksheet_column( p_id=>wwv_flow_api.id(350064935799161985),p_db_column_name=>'PRODUCT_UNITARY_PRICE',p_display_order=>10,p_column_identifier=>'J',p_column_label=>'Unit Price(€)',p_column_type=>'NUMBER',p_column_alignment=>'CENTER');wwv_flow_api.create_worksheet_column( p_id=>wwv_flow_api.id(350065366639161985),p_db_column_name=>'PRODUCT_TOTAL_PRICE',p_display_order=>11,p_column_identifier=>'K',p_column_label=>'Product Total Price(€)',p_column_type=>'NUMBER',p_column_alignment=>'CENTER');wwv_flow_api.create_worksheet_column( p_id=>wwv_flow_api.id(345821694363557543),p_db_column_name=>'Size Range',p_display_order=>21,p_column_identifier=>'L',p_column_label=>'Size range',p_column_type=>'STRING',p_column_alignment=>'CENTER');wwv_flow_api.create_worksheet_column( p_id=>wwv_flow_api.id(351688086789319247),p_db_column_name=>'IMAGE',p_display_order=>31,p_column_identifier=>'M',p_column_label=>'Image',p_column_link=>'f?p=&APP_ID.:6:&SESSION.::&DEBUG.:RP:P6_PRODUCT_ID:#PRODUCT_ID#',p_column_linktext=>'#IMAGE#',p_column_type=>'STRING',p_display_text_as=>'WITHOUT_MODIFICATION',p_column_alignment=>'CENTER',p_format_mask=>'PCT_GRAPH:::');wwv_flow_api.create_worksheet_rpt( p_id=>wwv_flow_api.id(350069360859179359),p_application_user=>'APXWS_DEFAULT',p_report_seq=>10,p_report_alias=>'3500700',p_status=>'PUBLIC',p_is_default=>'Y',p_display_rows=>50,p_report_columns=>'PRODUCT_NAME:PRODUCT_DESC:SEX_NAME:Size Range:IMAGE:ORDER_PRODUCT_QUANTITY:PRODUCT_UNITARY_PRICE:PRODUCT_TOTAL_PRICE:',p_flashback_enabled=>'N');wwv_flow_api.create_page_plug( p_id=>wwv_flow_api.id(1176475576386907570),p_plug_name=>'HOME_IMAGE',p_region_template_options=>'#DEFAULT#',p_plug_template=>wwv_flow_api.id(327260456234455539),p_plug_display_sequence=>11,p_include_in_reg_disp_sel_yn=>'N',p_plug_display_point=>'BODY',p_plug_query_row_template=>1,p_plug_query_options=>'DERIVED_REPORT_COLUMNS',p_attribute_01=>'N',p_attribute_02=>'HTML');wwv_flow_api.create_page_button( p_id=>wwv_flow_api.id(361126670315609821),p_button_sequence=>10,p_button_plug_id=>wwv_flow_api.id(350060829115161976),p_button_name=>'DELETE',p_button_action=>'REDIRECT_URL',p_button_template_options=>'#DEFAULT#',p_button_template_id=>wwv_flow_api.id(327293267790455585),p_button_image_alt=>'Cancel my order',p_button_position=>'RIGHT_OF_IR_SEARCH_BAR',p_button_redirect_url=>'javascript:apex.confirm(''Are you sure you want to cancel this order?'',''DELETE'');',p_button_execute_validations=>'N',p_button_condition=>wwv_flow_string.join(wwv_flow_t_varchar2('select oc.order_id, SUM(oc.order_product_quantity)  ','from SOK_ORDER_CONTENT oc','inner join SOK_ORDER o','on oc.order_id = o.order_id','where oc.order_id = :P20_ORDER_ID  and o.order_status_code = ''PAID''','group by oc.order_id')),p_button_condition_type=>'EXISTS');wwv_flow_api.create_page_branch( p_id=>wwv_flow_api.id(351684369689319210),p_branch_action=>'f?p=&APP_ID.:18:&SESSION.::&DEBUG.:RP::&success_msg=#SUCCESS_MSG#',p_branch_point=>'AFTER_PROCESSING',p_branch_type=>'REDIRECT_URL',p_branch_sequence=>10);wwv_flow_api.create_page_item( p_id=>wwv_flow_api.id(345821845030557544),p_name=>'P20_ORDER_ID',p_item_sequence=>20,p_item_plug_id=>wwv_flow_api.id(350060829115161976),p_display_as=>'NATIVE_HIDDEN',p_attribute_01=>'Y');wwv_flow_api.create_page_item( p_id=>wwv_flow_api.id(394742276891798057),p_name=>'P20_HOME_IMAGE',p_item_sequence=>10,p_item_plug_id=>wwv_flow_api.id(1176475576386907570),p_source=>'#APP_IMAGES#assorted_socks_2.png',p_source_type=>'STATIC',p_display_as=>'NATIVE_DISPLAY_IMAGE',p_tag_css_classes=>'picture',p_attribute_01=>'URL');wwv_flow_api.create_page_da_event( p_id=>wwv_flow_api.id(351723738637426840),p_name=>'on dialog close',p_event_sequence=>20,p_triggering_element_type=>'REGION',p_triggering_region_id=>wwv_flow_api.id(350060829115161976),p_bind_type=>'bind',p_bind_event_type=>'apexafterclosedialog');wwv_flow_api.create_page_da_action( p_id=>wwv_flow_api.id(351719461551400129),p_event_id=>wwv_flow_api.id(351723738637426840),p_event_result=>'TRUE',p_action_sequence=>10,p_execute_on_page_init=>'N',p_action=>'NATIVE_JAVASCRIPT_CODE',p_attribute_01=>'apex.message.showPageSuccess(this.data.successMessage.text)');wwv_flow_api.create_page_da_action( p_id=>wwv_flow_api.id(351724134802426843),p_event_id=>wwv_flow_api.id(351723738637426840),p_event_result=>'TRUE',p_action_sequence=>20,p_execute_on_page_init=>'N',p_action=>'NATIVE_REFRESH',p_affected_elements_type=>'REGION',p_affected_region_id=>wwv_flow_api.id(350060829115161976));wwv_flow_api.create_page_process( p_id=>wwv_flow_api.id(361128700656622989),p_process_sequence=>10,p_process_point=>'AFTER_SUBMIT',p_process_type=>'NATIVE_PLSQL',p_process_name=>'Process on cancel order content',p_process_sql_clob=>wwv_flow_string.join(wwv_flow_t_varchar2('declare','  loc_order_status_code        SOK_ORDER.order_status_code%TYPE;','  loc_product_detail_id        SOK_PRODUCT_DETAIL_LU.product_detail_id%TYPE;','  loc_order_product_quantity   SOK_ORDER_CONTENT.order_product_quantity%TYPE;','  loc_size_range_code          SOK_PRODUCT_DETAIL_LU.size_range_code%TYPE;','  loc_sex_code                 SOK_PRODUCT_DETAIL_LU.sex_code%TYPE;','  loc_product_detail_stock     SOK_PRODUCT_DETAIL_LU.product_detail_stock%TYPE;','  CURSOR','      c1 (val_order_id IN SOK_ORDER.order_id%TYPE) ','  IS ','      SELECT product_detail_id, order_product_quantity','      FROM SOK_ORDER_CONTENT_DETAIL_VW','      WHERE order_id = val_order_id;','begin','/* SOK_ORDER_UTIL.cancel_order (','                                  val_order_id => :P20_ORDER_ID)*/','  loc_order_status_code := SOK_ORDER_UTIL.u_order (','                                  val_order_id => :P20_ORDER_ID,','                                  val_order_status_code => ''CANCELLED'');','  ','  if loc_order_status_code = ''CANCELLED'' then','     for r1 in c1(:P20_ORDER_ID)','     loop','      --todo(  r1.columnA);','      select size_range_code, sex_code, product_detail_stock into loc_size_range_code, loc_sex_code, loc_product_detail_stock','      from SOK_PRODUCT_DETAIL_LU','      where product_detail_id = r1.product_detail_id;','      ','      loc_product_detail_stock := loc_product_detail_stock + r1.order_product_quantity;','     ','      SOK_PRODUCT_DETAIL_UTIL.u_product_detail (','          val_product_detail_id => r1.product_detail_id,','          val_size_range_code => loc_size_range_code,','          val_sex_code => loc_sex_code,','          val_product_detail_stock => loc_product_detail_stock);','     end loop;','    end if;','end;')),p_error_display_location=>'INLINE_IN_NOTIFICATION',p_process_when_button_id=>wwv_flow_api.id(361126670315609821),p_process_success_message=>'Your order has been successfully cancelled.');end;/