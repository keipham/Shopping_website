prompt --application/pages/page_00002beginwwv_flow_api.create_page( p_id=>2,p_user_interface_id=>wwv_flow_api.id(327304041051455600),p_name=>'C_U_ shopping cart',p_page_mode=>'MODAL',p_step_title=>'Purchase product',p_step_sub_title=>'Purchase product',p_step_sub_title_type=>'TEXT_WITH_SUBSTITUTIONS',p_first_item=>'NO_FIRST_ITEM',p_autocomplete_on_off=>'OFF',p_inline_css=>wwv_flow_string.join(wwv_flow_t_varchar2('.picture {','     height: 100px;','     width: 100px;','}','','body{','    font-family: ''Comic Sans MS'';','}')),p_page_template_options=>'#DEFAULT#',p_dialog_chained=>'Y',p_overwrite_navigation_list=>'N',p_page_is_public_y_n=>'Y',p_cache_mode=>'NOCACHE',p_last_updated_by=>'defaultUser',p_last_upd_yyyymmddhh24miss=>'20000101000000');wwv_flow_api.create_page_plug( p_id=>wwv_flow_api.id(344813823639650201),p_plug_name=>'Add to shopping cart',p_region_template_options=>'#DEFAULT#',p_plug_template=>wwv_flow_api.id(327260456234455539),p_plug_display_sequence=>20,p_include_in_reg_disp_sel_yn=>'N',p_plug_new_grid_row=>false,p_plug_new_grid_column=>false,p_plug_display_point=>'BODY',p_plug_query_options=>'DERIVED_REPORT_COLUMNS',p_attribute_01=>'N',p_attribute_02=>'HTML');wwv_flow_api.create_page_plug( p_id=>wwv_flow_api.id(690087802439984855),p_plug_name=>'Buttons',p_region_template_options=>'#DEFAULT#',p_plug_template=>wwv_flow_api.id(327260825035455539),p_plug_display_sequence=>30,p_include_in_reg_disp_sel_yn=>'N',p_plug_display_point=>'REGION_POSITION_03',p_plug_query_row_template=>1,p_plug_query_options=>'DERIVED_REPORT_COLUMNS',p_attribute_01=>'N',p_attribute_02=>'TEXT',p_attribute_03=>'Y');wwv_flow_api.create_page_button( p_id=>wwv_flow_api.id(382738754085483757),p_button_sequence=>30,p_button_plug_id=>wwv_flow_api.id(690087802439984855),p_button_name=>'CANCEL',p_button_action=>'DEFINED_BY_DA',p_button_template_options=>'#DEFAULT#',p_button_template_id=>wwv_flow_api.id(327293267790455585),p_button_image_alt=>'Cancel',p_button_position=>'REGION_TEMPLATE_CLOSE',p_warn_on_unsaved_changes=>null);wwv_flow_api.create_page_button( p_id=>wwv_flow_api.id(343987089220405450),p_button_sequence=>10,p_button_plug_id=>wwv_flow_api.id(690087802439984855),p_button_name=>'ADD',p_button_action=>'SUBMIT',p_button_template_options=>'#DEFAULT#:t-Button--iconRight',p_button_template_id=>wwv_flow_api.id(327293304788455585),p_button_is_hot=>'Y',p_button_image_alt=>'Add',p_button_position=>'REGION_TEMPLATE_NEXT',p_button_condition=>'P2_MEMBER_SQ',p_button_condition_type=>'ITEM_IS_NULL');wwv_flow_api.create_page_button( p_id=>wwv_flow_api.id(344816956608650232),p_button_sequence=>20,p_button_plug_id=>wwv_flow_api.id(690087802439984855),p_button_name=>'SAVE',p_button_action=>'SUBMIT',p_button_template_options=>'#DEFAULT#',p_button_template_id=>wwv_flow_api.id(327293267790455585),p_button_is_hot=>'Y',p_button_image_alt=>'Save',p_button_position=>'REGION_TEMPLATE_NEXT',p_button_condition=>'P2_MEMBER_SQ',p_button_condition_type=>'ITEM_IS_NOT_NULL');wwv_flow_api.create_page_item( p_id=>wwv_flow_api.id(343986392653405444),p_name=>'P2_SEX_CODE',p_is_required=>true,p_item_sequence=>70,p_item_plug_id=>wwv_flow_api.id(344813823639650201),p_prompt=>'Sex',p_source=>'P2_SEX_CODE',p_source_type=>'ITEM',p_display_as=>'NATIVE_SELECT_LIST',p_lov=>wwv_flow_string.join(wwv_flow_t_varchar2('select distinct sex_name as d, sex_code as r','from sok_product_detail_list_vw ','left outer join apex_collections ','on n001 = product_id','where product_id = :P2_product_id ','--and (product_detail_stock-to_number(nvl(n004, 0))) > 0','--where product_id = :P2_product_id and product_detail_stock > 0','order by sex_name asc;')),p_cHeight=>1,p_field_template=>wwv_flow_api.id(327292952744455582),p_item_template_options=>'#DEFAULT#',p_lov_display_extra=>'NO',p_attribute_01=>'NONE',p_attribute_02=>'N');wwv_flow_api.create_page_item( p_id=>wwv_flow_api.id(343986506997405445),p_name=>'P2_SIZE_RANGE_CODE',p_is_required=>true,p_item_sequence=>80,p_item_plug_id=>wwv_flow_api.id(344813823639650201),p_prompt=>'Size Range',p_source=>'P2_SIZE_RANGE_CODE',p_source_type=>'ITEM',p_display_as=>'NATIVE_SELECT_LIST',p_lov=>wwv_flow_string.join(wwv_flow_t_varchar2('select distinct size_lower_value||''-''||size_higher_value  as d, size_range_code as r','from sok_product_detail_list_vw','left outer join apex_collections','on n001 = product_id','where product_id = :P2_product_id and sex_code = :P2_sex_code','--and product_detail_stock-to_number(nvl(n004, 0)) > 0 ','order by size_range_code asc')),p_lov_cascade_parent_items=>'P2_SEX_CODE',p_ajax_items_to_submit=>'P2_SEX_CODE',p_ajax_optimize_refresh=>'Y',p_cHeight=>1,p_field_template=>wwv_flow_api.id(327292952744455582),p_item_template_options=>'#DEFAULT#',p_lov_display_extra=>'NO',p_attribute_01=>'NONE',p_attribute_02=>'N');wwv_flow_api.create_page_item( p_id=>wwv_flow_api.id(343986747229405447),p_name=>'P2_PRODUCT_NAME',p_item_sequence=>30,p_item_plug_id=>wwv_flow_api.id(344813823639650201),p_prompt=>'Name',p_display_as=>'NATIVE_DISPLAY_ONLY',p_field_template=>wwv_flow_api.id(327292794678455582),p_item_template_options=>'#DEFAULT#',p_attribute_01=>'Y',p_attribute_02=>'VALUE',p_attribute_04=>'Y');wwv_flow_api.create_page_item( p_id=>wwv_flow_api.id(343986816925405448),p_name=>'P2_PRODUCT_ID',p_item_sequence=>10,p_item_plug_id=>wwv_flow_api.id(344813823639650201),p_use_cache_before_default=>'NO',p_source=>'PRODUCT_ID',p_source_type=>'DB_COLUMN',p_display_as=>'NATIVE_HIDDEN',p_attribute_01=>'Y');wwv_flow_api.create_page_item( p_id=>wwv_flow_api.id(343986944768405449),p_name=>'P2_QUANTITY',p_item_sequence=>90,p_item_plug_id=>wwv_flow_api.id(344813823639650201),p_item_default=>'1',p_prompt=>'Quantity',p_source=>'P2_QUANTITY',p_source_type=>'ITEM',p_display_as=>'NATIVE_NUMBER_FIELD',p_cSize=>3,p_field_template=>wwv_flow_api.id(327292952744455582),p_item_template_options=>'#DEFAULT#',p_help_text=>'Please provide quantity.',p_attribute_03=>'right');wwv_flow_api.create_page_item( p_id=>wwv_flow_api.id(344816481517650227),p_name=>'P2_MEMBER_SQ',p_item_sequence=>20,p_item_plug_id=>wwv_flow_api.id(344813823639650201),p_display_as=>'NATIVE_HIDDEN',p_attribute_01=>'N');wwv_flow_api.create_page_item( p_id=>wwv_flow_api.id(382900588805154237),p_name=>'P2_PRODUCT_PRICE',p_item_sequence=>40,p_item_plug_id=>wwv_flow_api.id(344813823639650201),p_prompt=>'Price',p_display_as=>'NATIVE_DISPLAY_ONLY',p_begin_on_new_line=>'N',p_field_template=>wwv_flow_api.id(327292794678455582),p_item_template_options=>'#DEFAULT#',p_attribute_01=>'Y',p_attribute_02=>'VALUE',p_attribute_04=>'Y');wwv_flow_api.create_page_item( p_id=>wwv_flow_api.id(382900718306154239),p_name=>'P2_PRODUCT_STOCK',p_item_sequence=>60,p_item_plug_id=>wwv_flow_api.id(344813823639650201),p_prompt=>'Availability',p_display_as=>'NATIVE_DISPLAY_ONLY',p_field_template=>wwv_flow_api.id(327292794678455582),p_item_template_options=>'#DEFAULT#',p_attribute_01=>'N',p_attribute_02=>'VALUE',p_attribute_04=>'Y');wwv_flow_api.create_page_item( p_id=>wwv_flow_api.id(394443462055401465),p_name=>'P2_IMAGE',p_item_sequence=>100,p_item_plug_id=>wwv_flow_api.id(344813823639650201),p_use_cache_before_default=>'NO',p_source=>'PRODUCT_IMAGE',p_source_type=>'DB_COLUMN',p_display_as=>'NATIVE_DISPLAY_IMAGE',p_tag_css_classes=>'picture',p_begin_on_new_line=>'N',p_begin_on_new_field=>'N',p_display_when=>'P2_PRODUCT_ID',p_display_when_type=>'ITEM_IS_NOT_NULL',p_field_template=>wwv_flow_api.id(327292794678455582),p_item_template_options=>'#DEFAULT#',p_attribute_01=>'SQL',p_attribute_06=>wwv_flow_string.join(wwv_flow_t_varchar2('select product_image','from SOK_PRODUCT_LIST_VW ','where product_id = :P2_PRODUCT_ID')));wwv_flow_api.create_page_computation( p_id=>wwv_flow_api.id(382901189609154243),p_computation_sequence=>10,p_computation_item=>'P2_SEX_CODE',p_computation_point=>'AFTER_HEADER',p_computation_type=>'QUERY',p_computation=>wwv_flow_string.join(wwv_flow_t_varchar2('select MIN(sex_code)','from SOK_PRODUCT_DETAIL_LIST_VW','where product_id = :P2_PRODUCT_ID')),p_compute_when=>'P2_MEMBER_SQ',p_compute_when_type=>'ITEM_IS_NULL');wwv_flow_api.create_page_computation( p_id=>wwv_flow_api.id(386988452627327708),p_computation_sequence=>20,p_computation_item=>'P2_SEX_CODE',p_computation_point=>'AFTER_HEADER',p_computation_type=>'QUERY',p_computation=>wwv_flow_string.join(wwv_flow_t_varchar2('select c002','from apex_collections','where seq_id = :P2_MEMBER_SQ and n001 = :P2_PRODUCT_ID')),p_compute_when=>'P2_MEMBER_SQ',p_compute_when_type=>'ITEM_IS_NOT_NULL');wwv_flow_api.create_page_computation( p_id=>wwv_flow_api.id(386987757544327701),p_computation_sequence=>30,p_computation_item=>'P2_SIZE_RANGE_CODE',p_computation_point=>'AFTER_HEADER',p_computation_type=>'QUERY',p_computation=>wwv_flow_string.join(wwv_flow_t_varchar2('select MIN(size_range_code)','from SOK_PRODUCT_DETAIL_LIST_VW','where product_id = :P2_PRODUCT_ID and sex_code = :P2_SEX_CODE')),p_compute_when=>'P2_MEMBER_SQ',p_compute_when_type=>'ITEM_IS_NULL');wwv_flow_api.create_page_computation( p_id=>wwv_flow_api.id(386988574110327709),p_computation_sequence=>40,p_computation_item=>'P2_SIZE_RANGE_CODE',p_computation_point=>'AFTER_HEADER',p_computation_type=>'QUERY',p_computation=>wwv_flow_string.join(wwv_flow_t_varchar2('select n002','from apex_collections','where seq_id = :P2_MEMBER_SQ and n001 = :P2_PRODUCT_ID')),p_compute_when=>'P2_MEMBER_SQ',p_compute_when_type=>'ITEM_IS_NOT_NULL');wwv_flow_api.create_page_computation( p_id=>wwv_flow_api.id(386988623330327710),p_computation_sequence=>50,p_computation_item=>'P2_QUANTITY',p_computation_point=>'AFTER_HEADER',p_computation_type=>'QUERY',p_computation=>wwv_flow_string.join(wwv_flow_t_varchar2('select n004','from apex_collections','where seq_id = :P2_MEMBER_SQ and n001 = :P2_PRODUCT_ID')),p_compute_when=>'P2_MEMBER_SQ',p_compute_when_type=>'ITEM_IS_NOT_NULL');wwv_flow_api.create_page_computation( p_id=>wwv_flow_api.id(351686830474319235),p_computation_sequence=>60,p_computation_item=>'P2_PRODUCT_NAME',p_computation_point=>'AFTER_HEADER',p_computation_type=>'QUERY',p_computation=>wwv_flow_string.join(wwv_flow_t_varchar2('select product_name ','from SOK_PRODUCT_LU','where product_id = :P2_PRODUCT_ID')));wwv_flow_api.create_page_computation( p_id=>wwv_flow_api.id(382900603877154238),p_computation_sequence=>70,p_computation_item=>'P2_PRODUCT_PRICE',p_computation_point=>'AFTER_HEADER',p_computation_type=>'QUERY',p_computation=>wwv_flow_string.join(wwv_flow_t_varchar2('select product_price_amount||''€'' ','from SOK_PRODUCT_LIST_VW','where product_id = :P2_PRODUCT_ID')));wwv_flow_api.create_page_computation( p_id=>wwv_flow_api.id(382900804699154240),p_computation_sequence=>80,p_computation_item=>'P2_PRODUCT_STOCK',p_computation_point=>'AFTER_HEADER',p_computation_type=>'QUERY',p_computation=>wwv_flow_string.join(wwv_flow_t_varchar2('select CASE ','        WHEN a.product_detail_stock-to_number(nvl(b.n004, 0)) < 1 THEN ''Out of stock(''||(a.product_detail_stock-to_number(nvl(b.n004, 0)))||'')''','        WHEN a.product_detail_stock-to_number(nvl(b.n004, 0)) > 0 THEN ''In stock (''||(a.product_detail_stock-to_number(nvl(b.n004, 0)))||'')'' ','       END AS Availability','from SOK_PRODUCT_DETAIL_LIST_VW a','left outer join (select n001, n004 from apex_collections where n001 = :P2_PRODUCT_ID and c002 = :P2_SEX_CODE and n002 = :P2_SIZE_RANGE_CODE ) b','on b.n001 = a.product_id','where a.product_id = :P2_PRODUCT_ID and a.sex_code = :P2_SEX_CODE and a.size_range_code = :P2_SIZE_RANGE_CODE ')));wwv_flow_api.create_page_validation( p_id=>wwv_flow_api.id(387983071371538768),p_validation_name=>'Check if quantity is not negative or null',p_validation_sequence=>10,p_validation=>wwv_flow_string.join(wwv_flow_t_varchar2('begin','  if :P2_QUANTITY <= 0  then','    return false;','  else ','    return true;','  end if;','exception when others then','  logger.log_error(''Validation process "Check ordered quantity is not null or negative" failed. ''||SQLERRM);','end;')),p_validation_type=>'FUNC_BODY_RETURNING_BOOLEAN',p_error_message=>'The quantity cannot be null or negative. Thank you.',p_always_execute=>'Y',p_error_display_location=>'INLINE_WITH_FIELD_AND_NOTIFICATION');wwv_flow_api.create_page_validation( p_id=>wwv_flow_api.id(345157894613925448),p_validation_name=>'Check product_stock',p_validation_sequence=>30,p_validation=>wwv_flow_string.join(wwv_flow_t_varchar2('declare','  loc_total_stock             SOK_PRODUCT_DETAIL_LU.product_detail_stock%TYPE; ','  loc_cart                    SOK_PRODUCT_DETAIL_LU.product_detail_stock%TYPE; ','begin','  ','  select distinct a.product_detail_stock-to_number(nvl(b.n004, 0)), b.n004','  into loc_total_stock, loc_cart','  from SOK_PRODUCT_DETAIL_LIST_VW a','  left outer join (select n001, ','                          n004 ','                   from apex_collections ','                   where n001 = :P2_PRODUCT_ID and n002 = :P2_SIZE_RANGE_CODE and c002 = :P2_SEX_CODE) b','  on b.n001 = a.product_id','  where a.product_id = :P2_PRODUCT_ID and a.sex_code = :P2_SEX_CODE and a.size_range_code = :P2_SIZE_RANGE_CODE;',' ','  if loc_cart is null then','      if :P2_QUANTITY > loc_total_stock then','          return false;','      elsif :P2_QUANTITY <= loc_total_stock then','          return true;','      end if;','  elsif loc_cart is not null then','      if :P2_QUANTITY > loc_total_stock+loc_cart then','        return false;','      elsif :P2_QUANTITY <= loc_total_stock+loc_cart then','        return true;','      end if;','  end if;','exception when others then','  logger.log_error(''Validation process "Check product stock" failed. ''||SQLERRM);','end;')),p_validation_type=>'FUNC_BODY_RETURNING_BOOLEAN',p_error_message=>'Oops ! There isn''t enough product in stock. Please try again later. Thank you.',p_always_execute=>'N',p_validation_condition=>'ADD, SAVE',p_validation_condition_type=>'REQUEST_IN_CONDITION',p_error_display_location=>'INLINE_WITH_FIELD_AND_NOTIFICATION');wwv_flow_api.create_page_validation( p_id=>wwv_flow_api.id(386989044193327714),p_validation_name=>'Check product_stock on edit',p_validation_sequence=>40,p_validation=>wwv_flow_string.join(wwv_flow_t_varchar2('declare','  loc_total_stock             SOK_PRODUCT_DETAIL_LU.product_detail_stock%TYPE; ','  loc_cart                    SOK_PRODUCT_DETAIL_LU.product_detail_stock%TYPE; ','begin','','  select distinct a.product_detail_stock-to_number(nvl(b.n004, 0)), b.n004','  into loc_total_stock, loc_cart','  from SOK_PRODUCT_DETAIL_LIST_VW a','  left outer join (select n001, ','                          n004 ','                   from apex_collections ','                   where n001 = :P2_PRODUCT_ID and n002 = :P2_SIZE_RANGE_CODE and c002 = :P2_SEX_CODE) b','  on b.n001 = a.product_id','  where a.product_id = :P2_PRODUCT_ID and a.sex_code = :P2_SEX_CODE and a.size_range_code = :P2_SIZE_RANGE_CODE;',' ','  if loc_total_stock < 1 then','      return false;','  else','      return true;','  end if;','  ','','exception when others then','  logger.log_error(''Validation process "Check product stock" failed. ''||SQLERRM);','end;')),p_validation_type=>'FUNC_BODY_RETURNING_BOOLEAN',p_error_message=>'Oops ! There isn''t enough product in stock. Please try again later. Thank you.',p_always_execute=>'N',p_validation_condition_type=>'NEVER',p_when_button_pressed=>wwv_flow_api.id(344816956608650232),p_error_display_location=>'INLINE_WITH_FIELD_AND_NOTIFICATION');wwv_flow_api.create_page_da_event( p_id=>wwv_flow_api.id(382739102138486053),p_name=>'Cancel Dialog',p_event_sequence=>20,p_triggering_element_type=>'BUTTON',p_triggering_button_id=>wwv_flow_api.id(382738754085483757),p_bind_type=>'bind',p_bind_event_type=>'click');wwv_flow_api.create_page_da_action( p_id=>wwv_flow_api.id(382739497891486054),p_event_id=>wwv_flow_api.id(382739102138486053),p_event_result=>'TRUE',p_action_sequence=>10,p_execute_on_page_init=>'N',p_action=>'NATIVE_DIALOG_CANCEL',p_stop_execution_on_error=>'Y');wwv_flow_api.create_page_da_event( p_id=>wwv_flow_api.id(382900935550154241),p_name=>'on P2_SEX_CODE change',p_event_sequence=>30,p_triggering_element_type=>'ITEM',p_triggering_element=>'P2_SEX_CODE',p_bind_type=>'live',p_bind_event_type=>'change');wwv_flow_api.create_page_da_action( p_id=>wwv_flow_api.id(382901343575154245),p_event_id=>wwv_flow_api.id(382900935550154241),p_event_result=>'TRUE',p_action_sequence=>20,p_execute_on_page_init=>'N',p_action=>'NATIVE_EXECUTE_PLSQL_CODE',p_attribute_01=>wwv_flow_string.join(wwv_flow_t_varchar2('begin','logger.log(''sex''||1);','select distinct MIN(size_range_code)','into :P2_SIZE_RANGE_CODE','from SOK_PRODUCT_DETAIL_LIST_VW','where product_id = :P2_PRODUCT_ID and sex_code = :P2_SEX_CODE;','logger.log(''sex''||2);','select distinct CASE ','                    WHEN a.product_detail_stock-to_number(nvl(b.n004, 0)) < 1 THEN ''Out of stock(''||(a.product_detail_stock-to_number(nvl(b.n004, 0)))||'')'' ','                    WHEN a.product_detail_stock-to_number(nvl(b.n004, 0)) > 0 THEN ''In stock (''||(a.product_detail_stock-to_number(nvl(b.n004, 0)))||'')'' ','                END AS Availability','into :P2_PRODUCT_STOCK','from SOK_PRODUCT_DETAIL_LIST_VW a','left outer join (select n001, n004 from apex_collections where n001 = :P2_PRODUCT_ID and n002 = :P2_SIZE_RANGE_CODE and c002 = :P2_SEX_CODE) b','on b.n001 = a.product_id','where a.product_id = :P2_PRODUCT_ID and a.sex_code = :P2_SEX_CODE and a.size_range_code = :P2_SIZE_RANGE_CODE ;','logger.log(''sex''||3);','exception when others then','    logger.log_error(''Dynamic action "on sex_code change" failed. ''||SQLERRM);','    raise_application_error(-20001, ''Dynamic action "on sex_code change" failed. ''||SQLERRM);   ','end;','')),p_attribute_02=>'P2_PRODUCT_ID,P2_SEX_CODE,P2_SIZE_RANGE_CODE,P2_PRODUCT_STOCK',p_attribute_03=>'P2_SIZE_RANGE_CODE,P2_PRODUCT_STOCK',p_attribute_04=>'N',p_stop_execution_on_error=>'Y',p_wait_for_result=>'Y');wwv_flow_api.create_page_da_action( p_id=>wwv_flow_api.id(382901055617154242),p_event_id=>wwv_flow_api.id(382900935550154241),p_event_result=>'TRUE',p_action_sequence=>30,p_execute_on_page_init=>'N',p_action=>'NATIVE_REFRESH',p_affected_elements_type=>'REGION',p_affected_region_id=>wwv_flow_api.id(344813823639650201));wwv_flow_api.create_page_da_event( p_id=>wwv_flow_api.id(382901505082154247),p_name=>'on P2_SIZE_RANGE_CODE change',p_event_sequence=>40,p_triggering_element_type=>'ITEM',p_triggering_element=>'P2_SIZE_RANGE_CODE',p_bind_type=>'bind',p_bind_event_type=>'change');wwv_flow_api.create_page_da_action( p_id=>wwv_flow_api.id(382901661382154248),p_event_id=>wwv_flow_api.id(382901505082154247),p_event_result=>'TRUE',p_action_sequence=>10,p_execute_on_page_init=>'N',p_action=>'NATIVE_EXECUTE_PLSQL_CODE',p_attribute_01=>wwv_flow_string.join(wwv_flow_t_varchar2('BEGIN','  logger.log(''size''||1);','    select distinct CASE ','                    WHEN a.product_detail_stock-to_number(nvl(b.n004, 0)) < 1 THEN ''Out of stock(''||(a.product_detail_stock-to_number(nvl(b.n004, 0)))||'')'' ','                    WHEN a.product_detail_stock-to_number(nvl(b.n004, 0)) > 0 THEN ''In stock (''||(a.product_detail_stock-to_number(nvl(b.n004, 0)))||'')'' ','                END AS Availability','    into :P2_PRODUCT_STOCK','    from SOK_PRODUCT_DETAIL_LIST_VW a','    left outer join (select n001, n004 from apex_collections where n001 = :P2_PRODUCT_ID and n002 = :P2_SIZE_RANGE_CODE and c002 = :P2_SEX_CODE) b','    on b.n001 = a.product_id','    where a.product_id = :P2_PRODUCT_ID and a.sex_code = :P2_SEX_CODE and a.size_range_code = :P2_SIZE_RANGE_CODE ;','  ','  logger.log(''size''||2);','exception when others then','    logger.log_error(''Dynamic action "on size_range_code change" failed. ''||SQLERRM);','    raise_application_error(-20001, ''Dynamic action "on size_range_code change" failed. ''||SQLERRM); ','END;','','','')),p_attribute_02=>'P2_SIZE_RANGE_CODE,P2_SEX_CODE,P2_PRODUCT_ID',p_attribute_03=>'P2_PRODUCT_STOCK',p_attribute_04=>'N',p_stop_execution_on_error=>'Y',p_wait_for_result=>'Y');wwv_flow_api.create_page_da_action( p_id=>wwv_flow_api.id(382901693919154249),p_event_id=>wwv_flow_api.id(382901505082154247),p_event_result=>'TRUE',p_action_sequence=>20,p_execute_on_page_init=>'N',p_action=>'NATIVE_REFRESH',p_affected_elements_type=>'REGION',p_affected_region_id=>wwv_flow_api.id(344813823639650201));wwv_flow_api.create_page_process( p_id=>wwv_flow_api.id(344813938500650202),p_process_sequence=>10,p_process_point=>'AFTER_SUBMIT',p_process_type=>'NATIVE_PLSQL',p_process_name=>'Add to shopping cart',p_process_sql_clob=>wwv_flow_string.join(wwv_flow_t_varchar2('declare','  ','  loc_product_price_amount  SOK_PRODUCT_PRICE_LU.product_price_amount%TYPE;','  loc_total_product_price   SOK_PRODUCT_PRICE_LU.product_price_amount%TYPE;','  loc_count                 NUMBER := 0;','  loc_seq_id                NUMBER := 0;','  loc_name                  SOK_PRODUCT_LU.product_name%TYPE;','  loc_sex_code              SOK_PRODUCT_DETAIL_LU.sex_code%TYPE;','  loc_size_range_code       SOK_PRODUCT_DETAIL_LU.size_range_code%TYPE;','  loc_quantity              SOK_ORDER_CONTENT.order_product_quantity%TYPE;','  loc_old_price             SOK_PRODUCT_PRICE_LU.product_price_amount%TYPE;','  ','begin','','  --If the collection does not exist I create it','  if APEX_COLLECTION.COLLECTION_EXISTS (p_collection_name => ''MY_SOCK_COLLECTION'') = false then','       APEX_COLLECTION.CREATE_OR_TRUNCATE_COLLECTION(p_collection_name => ''MY_SOCK_COLLECTION'');','  end if;','   ','  --loc_product_price_amount initialisation will be used to calculate the total product price (unit price * quantity)','  select product_price_amount','  into   loc_product_price_amount','  from   sok_product_list_vw','  where  product_id = :P2_product_id;','  --calculate loc_total_product_price','  loc_total_product_price := loc_product_price_amount*:P2_quantity;','','  --If the same product has already been added to shopping cart, I get it''s seq_id ','  select count(seq_id) ','  into loc_count','  from apex_collections','  where EXISTS ( select n001 from apex_collections where n001 = :P2_product_id and c002 = :P2_sex_code and n002 = :P2_size_range_code);','','  if loc_count > 0 then','      select seq_id, c001, c002, n002, n004, n005','      into loc_seq_id, loc_name, loc_sex_code, loc_size_range_code, loc_quantity, loc_old_price','      from apex_collections','      where collection_name = ''MY_SOCK_COLLECTION'' and n001 = :P2_product_id and c002 = :P2_sex_code and n002 = :P2_size_range_code;',' ','      APEX_COLLECTION.UPDATE_MEMBER (','        p_collection_name => ''MY_SOCK_COLLECTION'',','        p_seq  => loc_seq_id,','        p_c001 => loc_name,','        p_c002 => loc_sex_code,','        p_n001 => :P2_product_id,','        p_n002 => loc_size_range_code,','        p_n004 => loc_quantity+:P2_quantity,','        p_n005 => loc_old_price+loc_total_product_price);','  ','  else',' ','   APEX_COLLECTION.ADD_MEMBER(','        p_collection_name => ''MY_SOCK_COLLECTION'',','        p_c001            => :P2_product_name,','        p_c002            => :P2_sex_code,','        p_n001            => :P2_product_id,','        p_n002            => :P2_size_range_code,','        p_n004            => :P2_quantity,','        p_n005            => loc_total_product_price','  );','  ','  end if;','exception when others then','    logger.log_error(''Process "Add to shopping cart" failed. ''||SQLERRM);','    raise_application_error(-20001, ''Process "Add to shopping cart. ''||SQLERRM);   ','end;')),p_process_error_message=>'Product cannot be added to cart.',p_error_display_location=>'INLINE_IN_NOTIFICATION',p_process_when_button_id=>wwv_flow_api.id(343987089220405450),p_process_success_message=>'This product has been successfully added to your shopping cart.');wwv_flow_api.create_page_process( p_id=>wwv_flow_api.id(344816312938650226),p_process_sequence=>20,p_process_point=>'AFTER_SUBMIT',p_process_type=>'NATIVE_PLSQL',p_process_name=>'Edit shopping cart',p_process_sql_clob=>wwv_flow_string.join(wwv_flow_t_varchar2('declare','  loc_product_price_amount  SOK_PRODUCT_PRICE_LU.product_price_amount%TYPE;','  loc_total_product_price   SOK_PRODUCT_PRICE_LU.product_price_amount%TYPE;','  loc_count                 NUMBER := 0;','  loc_seq_id                NUMBER := 0;','  loc_old_quantity          NUMBER := 0;','  loc_old_total_price       SOK_PRODUCT_PRICE_LU.product_price_amount%TYPE;','','begin','  --If the collection does not exist I create it','  if APEX_COLLECTION.COLLECTION_EXISTS (p_collection_name => ''MY_SOCK_COLLECTION'') = false then','       APEX_COLLECTION.CREATE_OR_TRUNCATE_COLLECTION(p_collection_name => ''MY_SOCK_COLLECTION'');','  end if;','  ','  --loc_product_price_amount initialisation','  select product_price_amount ','  into loc_product_price_amount','  from sok_product_list_vw','  where product_id = :P2_product_id;','  ','  --calculate loc_total_product_price','  loc_total_product_price := loc_product_price_amount*:P2_quantity;','  ','  --I check if a product with same properties has already been added to the cart','  select count(n001) ','  into loc_count','  from apex_collections','  where n001 = :P2_PRODUCT_ID and c002 = :P2_SEX_CODE and n002 = :P2_SIZE_RANGE_CODE;','  ','  if loc_count > 0 then','      select seq_id, n004, n005 ','      into loc_seq_id, loc_old_quantity, loc_old_total_price','      from apex_collections','      where n001 = :P2_PRODUCT_ID and c002 = :P2_SEX_CODE and n002 = :P2_SIZE_RANGE_CODE;','      ','      if loc_seq_id = :P2_MEMBER_SQ then','          logger.log(''mes seq_id sont identiques'');','      --in this case, it means that user is only editing the quantity of his product','          APEX_COLLECTION.UPDATE_MEMBER (','            p_collection_name => ''MY_SOCK_COLLECTION'',','            p_seq  => :P2_MEMBER_SQ,','            p_c001 => :P2_product_name,  ','            p_c002 => :P2_SEX_CODE,','            p_n001 => :P2_product_id,','            p_n002 => :P2_size_range_code,','            p_n004 => :P2_quantity,','            p_n005 => loc_total_product_price);','       ','      elsif loc_seq_id != :P2_MEMBER_SQ then','         logger.log(''mes seq_id sont différents'');','      --in this case it means that the new parameters match another product which is already in the cart. ','       ','          APEX_COLLECTION.UPDATE_MEMBER (','            p_collection_name => ''MY_SOCK_COLLECTION'',','            p_seq  => :P2_MEMBER_SQ,','            p_c001 => :P2_product_name,  ','            p_c002 => :P2_SEX_CODE,','            p_n001 => :P2_product_id,','            p_n002 => :P2_size_range_code,','            p_n004 => (loc_old_quantity+:P2_quantity),','            p_n005 => (loc_old_total_price+loc_total_product_price));','      ','          APEX_COLLECTION.DELETE_MEMBER(','            p_collection_name => ''MY_SOCK_COLLECTION'',','            p_seq             => loc_seq_id);','      end if;    ','    ','    else','        logger.log(''ni lun ni lautre'');','      APEX_COLLECTION.UPDATE_MEMBER (','        p_collection_name => ''MY_SOCK_COLLECTION'',','        p_seq  => :P2_MEMBER_SQ,','        p_c001 => :P2_product_name,  ','        p_c002 => :P2_SEX_CODE,','        p_n001 => :P2_product_id,','        p_n002 => :P2_size_range_code,','        p_n004 => :P2_quantity,','        p_n005 => loc_total_product_price);','   end if;','  ','','exception when others then','  logger.log_error(''Process "Edit shopping cart" failed. ''||SQLERRM);','  raise_application_error(-20001, ''Process "Edit shopping cart. ''||SQLERRM);     ','end;')),p_error_display_location=>'INLINE_IN_NOTIFICATION',p_process_when_button_id=>wwv_flow_api.id(344816956608650232),p_process_success_message=>'Your shopping cart has been successfully edited.');wwv_flow_api.create_page_process( p_id=>wwv_flow_api.id(344823843787912132),p_process_sequence=>30,p_process_point=>'AFTER_SUBMIT',p_process_type=>'NATIVE_SESSION_STATE',p_process_name=>'reset page',p_attribute_01=>'CLEAR_CACHE_CURRENT_PAGE',p_error_display_location=>'INLINE_IN_NOTIFICATION');wwv_flow_api.create_page_process( p_id=>wwv_flow_api.id(344822686692871984),p_process_sequence=>40,p_process_point=>'AFTER_SUBMIT',p_process_type=>'NATIVE_CLOSE_WINDOW',p_process_name=>'Close Dialog - ADD',p_error_display_location=>'INLINE_IN_NOTIFICATION',p_process_when_button_id=>wwv_flow_api.id(343987089220405450),p_process_success_message=>'This product has been successfully added to your shopping cart.');wwv_flow_api.create_page_process( p_id=>wwv_flow_api.id(345156980031925438),p_process_sequence=>50,p_process_point=>'AFTER_SUBMIT',p_process_type=>'NATIVE_CLOSE_WINDOW',p_process_name=>'Close Dialog - SAVE',p_error_display_location=>'INLINE_IN_NOTIFICATION',p_process_when_button_id=>wwv_flow_api.id(344816956608650232),p_process_success_message=>'Your shopping cart has been successfully edited.');wwv_flow_api.create_page_process( p_id=>wwv_flow_api.id(387056295932196167),p_process_sequence=>60,p_process_point=>'BEFORE_HEADER',p_process_type=>'NATIVE_PLSQL',p_process_name=>'Fetch Row from MY_SOCK_COLLECTION',p_process_sql_clob=>wwv_flow_string.join(wwv_flow_t_varchar2('begin','select c002, n002, n004 into :P2_SEX_CODE, :P2_SIZE_RANGE_CODE, :P2_QUANTITY from apex_collections where collection_name = ''MY_SOCK_COLECTION'' and seq_id = :P2_MEMBER_SQ;','end;')),p_error_display_location=>'INLINE_IN_NOTIFICATION',p_process_when_type=>'NEVER');end;/