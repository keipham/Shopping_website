prompt --application/pages/page_00005beginwwv_flow_api.create_page( p_id=>5,p_user_interface_id=>wwv_flow_api.id(327304041051455600),p_name=>'C_U_D products',p_page_mode=>'MODAL',p_step_title=>'Product management',p_step_sub_title_type=>'TEXT_WITH_SUBSTITUTIONS',p_first_item=>'NO_FIRST_ITEM',p_autocomplete_on_off=>'OFF',p_javascript_code=>'var htmldb_delete_message=''"DELETE_CONFIRM_MSG"'';',p_inline_css=>wwv_flow_string.join(wwv_flow_t_varchar2('.picture {','     height: 100px;','     width: 100px;','}')),p_page_template_options=>'#DEFAULT#',p_required_role=>wwv_flow_api.id(328224405980893970),p_dialog_chained=>'Y',p_overwrite_navigation_list=>'N',p_page_is_public_y_n=>'Y',p_protection_level=>'C',p_cache_mode=>'NOCACHE',p_last_updated_by=>'defaultUser',p_last_upd_yyyymmddhh24miss=>'20000101000000');wwv_flow_api.create_page_plug( p_id=>wwv_flow_api.id(329252460087503037),p_plug_name=>'Form on SOK_PRODUCT_LIST_VW',p_region_template_options=>'#DEFAULT#',p_plug_template=>wwv_flow_api.id(327260456234455539),p_plug_display_sequence=>10,p_include_in_reg_disp_sel_yn=>'N',p_plug_display_point=>'BODY',p_plug_query_row_template=>1,p_attribute_01=>'N',p_attribute_02=>'TEXT',p_attribute_03=>'Y');wwv_flow_api.create_page_plug( p_id=>wwv_flow_api.id(343985716708405437),p_plug_name=>'PRODUCT_IMAGE',p_parent_plug_id=>wwv_flow_api.id(329252460087503037),p_region_template_options=>'#DEFAULT#',p_plug_template=>wwv_flow_api.id(327260456234455539),p_plug_display_sequence=>10,p_include_in_reg_disp_sel_yn=>'N',p_plug_display_point=>'BODY',p_plug_query_options=>'DERIVED_REPORT_COLUMNS',p_plug_display_condition_type=>'FUNCTION_BODY',p_plug_display_when_condition=>wwv_flow_string.join(wwv_flow_t_varchar2('declare','begin','  if :P5_PRODUCT_ID is not null then','    for c1 in (select nvl(dbms_lob.getlength(product_image),0) l','               from sok_product_lu','               where product_id = :P5_PRODUCT_ID)','    loop','      if c1.l > 0 then','        return true;','      end if;','    end loop;','  end if;','  return false;','end;')),p_attribute_01=>'N',p_attribute_02=>'HTML');wwv_flow_api.create_page_plug( p_id=>wwv_flow_api.id(329253096077503037),p_plug_name=>'Buttons',p_region_template_options=>'#DEFAULT#',p_plug_template=>wwv_flow_api.id(327260825035455539),p_plug_display_sequence=>10,p_include_in_reg_disp_sel_yn=>'N',p_plug_display_point=>'REGION_POSITION_03',p_plug_query_row_template=>1,p_attribute_01=>'N',p_attribute_02=>'TEXT',p_attribute_03=>'Y');wwv_flow_api.create_page_button( p_id=>wwv_flow_api.id(329253536344503037),p_button_sequence=>10,p_button_plug_id=>wwv_flow_api.id(329253096077503037),p_button_name=>'CANCEL',p_button_action=>'DEFINED_BY_DA',p_button_template_options=>'#DEFAULT#',p_button_template_id=>wwv_flow_api.id(327293267790455585),p_button_image_alt=>'Cancel',p_button_position=>'REGION_TEMPLATE_CLOSE',p_warn_on_unsaved_changes=>null,p_security_scheme=>wwv_flow_api.id(328224405980893970));wwv_flow_api.create_page_button( p_id=>wwv_flow_api.id(329253069686503037),p_button_sequence=>20,p_button_plug_id=>wwv_flow_api.id(329253096077503037),p_button_name=>'DELETE',p_button_action=>'REDIRECT_URL',p_button_template_options=>'#DEFAULT#',p_button_template_id=>wwv_flow_api.id(327293267790455585),p_button_image_alt=>'Delete',p_button_position=>'REGION_TEMPLATE_DELETE',p_button_redirect_url=>'javascript:apex.confirm(htmldb_delete_message,''DELETE'');',p_button_execute_validations=>'N',p_button_condition=>'P5_PRODUCT_ID',p_button_condition_type=>'ITEM_IS_NOT_NULL',p_security_scheme=>wwv_flow_api.id(328224405980893970),p_database_action=>'DELETE');wwv_flow_api.create_page_button( p_id=>wwv_flow_api.id(329252972607503037),p_button_sequence=>30,p_button_plug_id=>wwv_flow_api.id(329253096077503037),p_button_name=>'SAVE',p_button_action=>'SUBMIT',p_button_template_options=>'#DEFAULT#',p_button_template_id=>wwv_flow_api.id(327293267790455585),p_button_is_hot=>'Y',p_button_image_alt=>'Save',p_button_position=>'REGION_TEMPLATE_NEXT',p_button_condition=>'P5_PRODUCT_ID',p_button_condition_type=>'ITEM_IS_NOT_NULL',p_security_scheme=>wwv_flow_api.id(328224405980893970),p_database_action=>'UPDATE');wwv_flow_api.create_page_button( p_id=>wwv_flow_api.id(329252806096503037),p_button_sequence=>40,p_button_plug_id=>wwv_flow_api.id(329253096077503037),p_button_name=>'CREATE',p_button_action=>'SUBMIT',p_button_template_options=>'#DEFAULT#',p_button_template_id=>wwv_flow_api.id(327293267790455585),p_button_is_hot=>'Y',p_button_image_alt=>'Create',p_button_position=>'REGION_TEMPLATE_NEXT',p_button_condition=>'P5_PRODUCT_ID',p_button_condition_type=>'ITEM_IS_NULL',p_security_scheme=>wwv_flow_api.id(328224405980893970),p_database_action=>'INSERT');wwv_flow_api.create_page_branch( p_id=>wwv_flow_api.id(394556560216987633),p_branch_name=>'Redirect to product details after create product',p_branch_action=>'f?p=&APP_ID.:12:&SESSION.::&DEBUG.:RP,12:P12_PRODUCT_ID:&P5_PRODUCT_ID.&success_msg=#SUCCESS_MSG#',p_branch_point=>'AFTER_PROCESSING',p_branch_type=>'REDIRECT_URL',p_branch_when_button_id=>wwv_flow_api.id(329252806096503037),p_branch_sequence=>40);wwv_flow_api.create_page_item( p_id=>wwv_flow_api.id(329255935550503040),p_name=>'P5_PRODUCT_ID',p_item_sequence=>10,p_item_plug_id=>wwv_flow_api.id(329252460087503037),p_use_cache_before_default=>'NO',p_prompt=>'Product Id',p_source=>'PRODUCT_ID',p_source_type=>'DB_COLUMN',p_display_as=>'NATIVE_HIDDEN',p_label_alignment=>'RIGHT',p_field_template=>wwv_flow_api.id(327292794678455582),p_item_template_options=>'#DEFAULT#',p_protection_level=>'S',p_attribute_01=>'Y');wwv_flow_api.create_page_item( p_id=>wwv_flow_api.id(329256362293503064),p_name=>'P5_PRODUCT_NAME',p_is_required=>true,p_item_sequence=>50,p_item_plug_id=>wwv_flow_api.id(329252460087503037),p_use_cache_before_default=>'NO',p_prompt=>'Name',p_source=>'PRODUCT_NAME',p_source_type=>'DB_COLUMN',p_display_as=>'NATIVE_AUTO_COMPLETE',p_lov=>wwv_flow_string.join(wwv_flow_t_varchar2('select product_name ','from SOK_PRODUCT_LU','where product_name = :P5_PRODUCT_NAME;')),p_cSize=>30,p_field_template=>wwv_flow_api.id(327292952744455582),p_item_template_options=>'#DEFAULT#',p_lov_display_extra=>'YES',p_attribute_01=>'CONTAINS_IGNORE',p_attribute_04=>'N',p_attribute_06=>'Y',p_attribute_07=>'Y',p_attribute_08=>'Y');wwv_flow_api.create_page_item( p_id=>wwv_flow_api.id(329256605923503064),p_name=>'P5_PRODUCT_DESC',p_item_sequence=>60,p_item_plug_id=>wwv_flow_api.id(329252460087503037),p_use_cache_before_default=>'NO',p_prompt=>'Description',p_source=>'PRODUCT_DESC',p_source_type=>'DB_COLUMN',p_display_as=>'NATIVE_TEXTAREA',p_cSize=>60,p_cMaxlength=>240,p_cHeight=>4,p_field_template=>wwv_flow_api.id(327292794678455582),p_item_template_options=>'#DEFAULT#',p_attribute_01=>'Y',p_attribute_02=>'N',p_attribute_03=>'N',p_attribute_04=>'BOTH');wwv_flow_api.create_page_item( p_id=>wwv_flow_api.id(329257066661503064),p_name=>'P5_PRODUCT_IMAGE',p_item_sequence=>70,p_item_plug_id=>wwv_flow_api.id(329252460087503037),p_use_cache_before_default=>'NO',p_prompt=>'Image',p_post_element_text=>'<canvas id="image-preview" width="100" height="50" style="text-align:center; margin: -7px 0px 0px 30px;"></canvas>',p_source=>'PRODUCT_IMAGE',p_source_type=>'DB_COLUMN',p_display_as=>'NATIVE_FILE',p_cSize=>60,p_field_template=>wwv_flow_api.id(327292794678455582),p_item_template_options=>'#DEFAULT#',p_security_scheme=>wwv_flow_api.id(328224405980893970),p_attribute_01=>'APEX_APPLICATION_TEMP_FILES',p_attribute_09=>'SESSION',p_attribute_10=>'N',p_attribute_11=>'image/*');wwv_flow_api.create_page_item( p_id=>wwv_flow_api.id(329259058810503065),p_name=>'P5_PRODUCT_PRICE_AMOUNT',p_is_required=>true,p_item_sequence=>120,p_item_plug_id=>wwv_flow_api.id(329252460087503037),p_use_cache_before_default=>'NO',p_prompt=>'Price(â‚¬)',p_source=>'PRODUCT_PRICE_AMOUNT',p_source_type=>'DB_COLUMN',p_display_as=>'NATIVE_TEXT_FIELD',p_cSize=>22,p_cMaxlength=>255,p_field_template=>wwv_flow_api.id(327292952744455582),p_item_template_options=>'#DEFAULT#',p_attribute_01=>'N',p_attribute_02=>'N',p_attribute_04=>'TEXT',p_attribute_05=>'NONE');wwv_flow_api.create_page_item( p_id=>wwv_flow_api.id(343985816771405438),p_name=>'P5_IMAGE',p_item_sequence=>130,p_item_plug_id=>wwv_flow_api.id(329252460087503037),p_use_cache_before_default=>'NO',p_source=>'PRODUCT_IMAGE',p_source_type=>'DB_COLUMN',p_display_as=>'NATIVE_DISPLAY_IMAGE',p_tag_css_classes=>'picture',p_display_when=>'P5_PRODUCT_ID',p_display_when_type=>'ITEM_IS_NOT_NULL',p_field_template=>wwv_flow_api.id(327292794678455582),p_item_template_options=>'#DEFAULT#',p_attribute_01=>'SQL',p_attribute_06=>wwv_flow_string.join(wwv_flow_t_varchar2('select product_image','from SOK_PRODUCT_LIST_VW ','where product_id = :P5_PRODUCT_ID')));wwv_flow_api.create_page_computation( p_id=>wwv_flow_api.id(382899358701154225),p_computation_sequence=>10,p_computation_item=>'P5_PRODUCT_IMAGE',p_computation_type=>'ITEM_VALUE',p_computation=>'P5_IMAGE',p_compute_when=>'P5_PRODUCT_IMAGE',p_compute_when_type=>'ITEM_IS_NULL');wwv_flow_api.create_page_validation( p_id=>wwv_flow_api.id(329195603515339526),p_validation_name=>'Check if products has been ordered',p_validation_sequence=>10,p_validation=>wwv_flow_string.join(wwv_flow_t_varchar2('begin','','  if SOK_PRODUCT_UTIL.product_was_ordered(val_product_id => :P5_product_id) = true then','      logger.log(:P5_product_id);','      return false;','  elsif SOK_PRODUCT_UTIL.product_was_ordered(val_product_id => :P5_product_id) = false then','      return true;','  end if;','  ','end;')),p_validation_type=>'FUNC_BODY_RETURNING_BOOLEAN',p_error_message=>'This product cannot be deleted as it was ordered by a client.',p_always_execute=>'N',p_when_button_pressed=>wwv_flow_api.id(329253069686503037),p_error_display_location=>'INLINE_IN_NOTIFICATION',p_security_scheme=>wwv_flow_api.id(328224405980893970));wwv_flow_api.create_page_da_event( p_id=>wwv_flow_api.id(329253643675503037),p_name=>'Cancel Dialog',p_event_sequence=>10,p_triggering_element_type=>'BUTTON',p_triggering_button_id=>wwv_flow_api.id(329253536344503037),p_bind_type=>'bind',p_bind_event_type=>'click');wwv_flow_api.create_page_da_action( p_id=>wwv_flow_api.id(329254412737503039),p_event_id=>wwv_flow_api.id(329253643675503037),p_event_result=>'TRUE',p_action_sequence=>10,p_execute_on_page_init=>'N',p_action=>'NATIVE_DIALOG_CANCEL',p_stop_execution_on_error=>'Y');wwv_flow_api.create_page_da_event( p_id=>wwv_flow_api.id(382899410666154226),p_name=>'Preview',p_event_sequence=>20,p_triggering_element_type=>'ITEM',p_triggering_element=>'P5_PRODUCT_IMAGE',p_bind_type=>'bind',p_bind_event_type=>'change');wwv_flow_api.create_page_da_action( p_id=>wwv_flow_api.id(382899581268154227),p_event_id=>wwv_flow_api.id(382899410666154226),p_event_result=>'TRUE',p_action_sequence=>10,p_execute_on_page_init=>'N',p_action=>'NATIVE_JAVASCRIPT_CODE',p_attribute_01=>wwv_flow_string.join(wwv_flow_t_varchar2('try{','    var canvas = $x(''image-preview'');','    var ctx = canvas.getContext(''2d'');','    var img = new Image;','    ','img.src = window.URL.createObjectURL(this.triggeringElement.files[0]);','    img.onload = function() {','        if (img.width > 200) {','            canvas.style.width = "100px";','        }','        canvas.width = img.width;','        canvas.height = img.height;','        ctx.drawImage(img, 0, 0);','        $("#container-img-preview").show();','    }','} catch (e) {','    console.log(e);','}')));wwv_flow_api.create_page_da_event( p_id=>wwv_flow_api.id(383704276851197729),p_name=>'on dialog close',p_event_sequence=>30,p_triggering_element_type=>'REGION',p_triggering_region_id=>wwv_flow_api.id(329252460087503037),p_bind_type=>'bind',p_bind_event_type=>'apexafterclosedialog');wwv_flow_api.create_page_da_action( p_id=>wwv_flow_api.id(383705109738197735),p_event_id=>wwv_flow_api.id(383704276851197729),p_event_result=>'TRUE',p_action_sequence=>10,p_execute_on_page_init=>'N',p_action=>'NATIVE_JAVASCRIPT_CODE',p_attribute_01=>'apex.message.showPageSuccess(this.data.successMessage.text)',p_stop_execution_on_error=>'Y');wwv_flow_api.create_page_da_action( p_id=>wwv_flow_api.id(383704594633197734),p_event_id=>wwv_flow_api.id(383704276851197729),p_event_result=>'TRUE',p_action_sequence=>20,p_execute_on_page_init=>'Y',p_action=>'NATIVE_REFRESH',p_affected_elements_type=>'REGION',p_affected_region_id=>wwv_flow_api.id(329252460087503037));wwv_flow_api.create_page_process( p_id=>wwv_flow_api.id(329259826137503067),p_process_sequence=>10,p_process_point=>'AFTER_HEADER',p_process_type=>'NATIVE_FORM_FETCH',p_process_name=>'Fetch Row from SOK_PRODUCT_LIST_VW',p_attribute_02=>'SOK_PRODUCT_LIST_VW',p_attribute_03=>'P5_PRODUCT_ID',p_attribute_04=>'PRODUCT_ID',p_error_display_location=>'INLINE_IN_NOTIFICATION');wwv_flow_api.create_page_process( p_id=>wwv_flow_api.id(329260264310503067),p_process_sequence=>30,p_process_point=>'AFTER_SUBMIT',p_process_type=>'NATIVE_PLSQL',p_process_name=>'Process create product',p_process_sql_clob=>wwv_flow_string.join(wwv_flow_t_varchar2('declare','  loc_product_image SOK_PRODUCT_LU.product_image%TYPE;','begin','  select blob_content','  into   loc_product_image','  from   APEX_APPLICATION_TEMP_FILES','  where  name  = :P5_PRODUCT_IMAGE;','  logger.log(:P5_PRODUCT_IMAGE);','  :P5_product_id := SOK_PRODUCT_UTIL.c_product(','    val_product_name => :P5_product_name,','    val_product_desc => :P5_product_desc,','    val_product_image => loc_product_image,','    val_product_price_amount => :P5_product_price_amount','   );',' ','end;','')),p_error_display_location=>'INLINE_IN_NOTIFICATION',p_process_when_button_id=>wwv_flow_api.id(329252806096503037),p_process_when=>'CREATE',p_process_when_type=>'REQUEST_IN_CONDITION',p_process_success_message=>'Action Processed.',p_security_scheme=>wwv_flow_api.id(328224405980893970));wwv_flow_api.create_page_process( p_id=>wwv_flow_api.id(329194505750339515),p_process_sequence=>50,p_process_point=>'AFTER_SUBMIT',p_process_type=>'NATIVE_PLSQL',p_process_name=>'Process update product',p_process_sql_clob=>wwv_flow_string.join(wwv_flow_t_varchar2('declare','  loc_product_image SOK_PRODUCT_LU.product_image%TYPE;','begin','  if :P5_PRODUCT_IMAGE is not null then','      select blob_content','      into   loc_product_image','      from   APEX_APPLICATION_TEMP_FILES','      where  name  = :P5_PRODUCT_IMAGE;','  else ','      loc_product_image := null;','  end if;','  --update product and it''s price','  SOK_PRODUCT_UTIL.u_product(','    val_product_id => :P5_product_id,','    val_product_name => :P5_product_name,','    val_product_desc => :P5_product_desc,','    val_product_image => loc_product_image,','    val_product_price_amount => :P5_product_price_amount','  );','  ','end;','')),p_error_display_location=>'INLINE_IN_NOTIFICATION',p_process_when_button_id=>wwv_flow_api.id(329252972607503037),p_process_when=>'SAVE',p_process_when_type=>'REQUEST_IN_CONDITION',p_process_success_message=>'Action Processed.');wwv_flow_api.create_page_process( p_id=>wwv_flow_api.id(329194843260339518),p_process_sequence=>70,p_process_point=>'AFTER_SUBMIT',p_process_type=>'NATIVE_PLSQL',p_process_name=>'Process delete product',p_process_sql_clob=>wwv_flow_string.join(wwv_flow_t_varchar2('begin','','  --I delete product from table SOK_PRODUCT_LU, prices associated with selected product from table SOK_PRODUCT_PRICE_LU and all product details associated from SOK_PRODUCT_DETAILS_LU','  SOK_PRODUCT_UTIL.d_product(','      val_product_id => :P5_product_id','  );','','end;','')),p_error_display_location=>'INLINE_IN_NOTIFICATION',p_process_when_button_id=>wwv_flow_api.id(329253069686503037),p_process_when=>'DELETE',p_process_when_type=>'REQUEST_IN_CONDITION',p_process_success_message=>'Action Processed.',p_security_scheme=>wwv_flow_api.id(328224405980893970));wwv_flow_api.create_page_process( p_id=>wwv_flow_api.id(329260640390503067),p_process_sequence=>80,p_process_point=>'AFTER_SUBMIT',p_process_type=>'NATIVE_SESSION_STATE',p_process_name=>'reset page',p_attribute_01=>'CLEAR_CACHE_CURRENT_PAGE',p_error_display_location=>'INLINE_IN_NOTIFICATION',p_process_when_button_id=>wwv_flow_api.id(329253069686503037));wwv_flow_api.create_page_process( p_id=>wwv_flow_api.id(329261013853503067),p_process_sequence=>90,p_process_point=>'AFTER_SUBMIT',p_process_type=>'NATIVE_CLOSE_WINDOW',p_process_name=>'Close Dialog',p_error_display_location=>'INLINE_IN_NOTIFICATION',p_process_when=>'SAVE,DELETE',p_process_when_type=>'REQUEST_IN_CONDITION',p_process_success_message=>'Action processed.');end;/